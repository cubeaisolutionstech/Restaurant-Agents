<!DOCTYPE html>
<html>
<head>
    <title>MML Restaurant System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üîß MML Restaurant System Test Dashboard</h1>
    
    <div class="test-section">
        <h2>üé§ Voice System Tests</h2>
        <button onclick="testBrowserSupport()">Test Browser Support</button>
        <button onclick="testVoiceAPI()">Test Voice API</button>
        <button onclick="testSpeechRecognition()">Test Speech Recognition</button>
    </div>

    <div class="test-section">
        <h2>üóÑÔ∏è Database Tests</h2>
        <button onclick="testMongoConnection()">Test MongoDB Connection</button>
        <button onclick="testReservationSave()">Test Reservation Save</button>
        <button onclick="testDataRetrieval()">Test Data Retrieval</button>
    </div>

    <div class="test-section">
        <h2>üìã Modal & UI Tests</h2>
        <button onclick="testConfirmationModal()">Test Confirmation Modal</button>
        <button onclick="testFormValidation()">Test Form Validation</button>
        <button onclick="testResponsiveDesign()">Test Responsive Design</button>
    </div>

    <div class="test-section">
        <h2>üîÑ Integration Tests</h2>
        <button onclick="testCompleteFlow()">Test Complete Booking Flow</button>
        <button onclick="testErrorHandling()">Test Error Handling</button>
        <button onclick="testOfflineMode()">Test Offline Mode</button>
    </div>

    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function addResult(test, status, message) {
            const div = document.createElement('div');
            div.className = `test-result ${status}`;
            div.innerHTML = `<strong>${test}:</strong> ${message}`;
            results.appendChild(div);
        }

        // Browser Support Tests
        function testBrowserSupport() {
            addResult('Browser Support', 'info', 'Testing browser compatibility...');
            
            // Speech Synthesis
            if ('speechSynthesis' in window) {
                addResult('Speech Synthesis', 'pass', 'Text-to-speech supported ‚úÖ');
            } else {
                addResult('Speech Synthesis', 'fail', 'Text-to-speech NOT supported ‚ùå');
            }

            // Speech Recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                addResult('Speech Recognition', 'pass', 'Speech recognition supported ‚úÖ');
            } else {
                addResult('Speech Recognition', 'fail', 'Speech recognition NOT supported ‚ùå');
            }

            // Web Audio API
            if ('AudioContext' in window || 'webkitAudioContext' in window) {
                addResult('Web Audio API', 'pass', 'Web Audio API supported ‚úÖ');
            } else {
                addResult('Web Audio API', 'fail', 'Web Audio API NOT supported ‚ùå');
            }

            // Local Storage
            if (typeof(Storage) !== "undefined") {
                addResult('Local Storage', 'pass', 'Local storage supported ‚úÖ');
            } else {
                addResult('Local Storage', 'fail', 'Local storage NOT supported ‚ùå');
            }
        }

        // Voice API Tests
        function testVoiceAPI() {
            addResult('Voice API', 'info', 'Testing voice API...');
            
            try {
                const voices = speechSynthesis.getVoices();
                addResult('Voice Loading', 'pass', `Found ${voices.length} voices`);
                
                // Test female voices
                const femaleVoices = voices.filter(voice => 
                    voice.name.toLowerCase().includes('female') ||
                    voice.name.toLowerCase().includes('sara') ||
                    voice.name.toLowerCase().includes('emma') ||
                    voice.name.toLowerCase().includes('zira')
                );
                addResult('Female Voices', femaleVoices.length > 0 ? 'pass' : 'info', 
                    `Found ${femaleVoices.length} female voices`);

                // Test voice synthesis
                const utterance = new SpeechSynthesisUtterance("Test message");
                utterance.onstart = () => addResult('Voice Test', 'pass', 'Voice synthesis working ‚úÖ');
                utterance.onerror = () => addResult('Voice Test', 'fail', 'Voice synthesis failed ‚ùå');
                speechSynthesis.speak(utterance);

            } catch (error) {
                addResult('Voice API', 'fail', `Voice API error: ${error.message}`);
            }
        }

        // Speech Recognition Test
        function testSpeechRecognition() {
            addResult('Speech Recognition', 'info', 'Testing speech recognition...');
            
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.lang = 'en-US';
                recognition.interimResults = true;
                recognition.maxAlternatives = 10;
                recognition.continuous = true;

                recognition.onstart = () => {
                    addResult('Recognition Start', 'pass', 'Speech recognition started ‚úÖ');
                    setTimeout(() => recognition.stop(), 2000);
                };

                recognition.onend = () => {
                    addResult('Recognition End', 'pass', 'Speech recognition stopped ‚úÖ');
                };

                recognition.onerror = (event) => {
                    addResult('Recognition Error', 'fail', `Recognition error: ${event.error}`);
                };

                recognition.onresult = (event) => {
                    addResult('Recognition Result', 'pass', 'Speech recognition working ‚úÖ');
                };

                // Request microphone permission
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(() => {
                        addResult('Microphone Access', 'pass', 'Microphone permission granted ‚úÖ');
                        recognition.start();
                    })
                    .catch((error) => {
                        addResult('Microphone Access', 'fail', `Microphone error: ${error.message}`);
                    });

            } catch (error) {
                addResult('Speech Recognition', 'fail', `Recognition error: ${error.message}`);
            }
        }

        // MongoDB Connection Test
        async function testMongoConnection() {
            addResult('MongoDB Connection', 'info', 'Testing MongoDB connection...');
            
            try {
                const response = await fetch('http://localhost:3000/health');
                if (response.ok) {
                    const data = await response.json();
                    addResult('MongoDB API', 'pass', `API server running: ${data.message} ‚úÖ`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                addResult('MongoDB API', 'fail', `API connection failed: ${error.message} ‚ùå`);
                addResult('MongoDB Setup', 'info', 'Make sure to run: npm install && node server.js');
            }
        }

        // Test Reservation Save
        async function testReservationSave() {
            addResult('Reservation Save', 'info', 'Testing reservation save...');
            
            const testReservation = {
                timestamp: new Date().toISOString(),
                name: 'Test Customer',
                date: 'August 25th, 2025',
                time: '7:00 PM',
                members: '2 people',
                specialRequests: 'Test request',
                paymentStatus: 'Pending',
                confirmation: `TEST-${Date.now()}`,
                status: 'Test'
            };

            try {
                const response = await fetch('http://localhost:3000/api/reservations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testReservation)
                });

                if (response.ok) {
                    const result = await response.json();
                    addResult('Reservation Save', 'pass', `Test reservation saved: ${result.confirmation} ‚úÖ`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                addResult('Reservation Save', 'fail', `Save failed: ${error.message} ‚ùå`);
            }
        }

        // Test Data Retrieval
        async function testDataRetrieval() {
            addResult('Data Retrieval', 'info', 'Testing data retrieval...');
            
            try {
                const response = await fetch('http://localhost:3000/api/reservations');
                if (response.ok) {
                    const data = await response.json();
                    addResult('Data Retrieval', 'pass', `Retrieved ${data.count} reservations ‚úÖ`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                addResult('Data Retrieval', 'fail', `Retrieval failed: ${error.message} ‚ùå`);
            }
        }

        // Test Confirmation Modal
        function testConfirmationModal() {
            addResult('Confirmation Modal', 'info', 'Testing confirmation modal...');
            
            // Test if modal elements exist
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div class="modal-overlay" id="testModal" style="display: block;">
                    <div class="confirmation-modal">
                        <h2>Test Modal</h2>
                        <div class="reservation-details">
                            <div class="detail-item">
                                <span class="detail-label">Name:</span>
                                <span class="detail-value">Test</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                const testModal = document.getElementById('testModal');
                if (testModal) {
                    addResult('Modal Display', 'pass', 'Confirmation modal can be displayed ‚úÖ');
                    testModal.remove();
                } else {
                    addResult('Modal Display', 'fail', 'Modal display failed ‚ùå');
                }
            }, 100);
        }

        // Test Form Validation
        function testFormValidation() {
            addResult('Form Validation', 'info', 'Testing form validation...');
            
            const testData = {
                name: 'John Smith',
                date: 'August 25th',
                time: '7:00 PM',
                members: '4 people',
                specialRequests: 'Window table',
                paymentStatus: 'Pending'
            };

            let valid = true;
            let errors = [];

            if (!testData.name || testData.name.length < 2) {
                valid = false;
                errors.push('Name too short');
            }

            if (!testData.date || !testData.time) {
                valid = false;
                errors.push('Date/time missing');
            }

            if (!testData.members || !testData.members.includes('people')) {
                valid = false;
                errors.push('Members format invalid');
            }

            if (valid) {
                addResult('Form Validation', 'pass', 'All validation checks passed ‚úÖ');
            } else {
                addResult('Form Validation', 'fail', `Validation errors: ${errors.join(', ')} ‚ùå`);
            }
        }

        // Test Responsive Design
        function testResponsiveDesign() {
            addResult('Responsive Design', 'info', 'Testing responsive design...');
            
            const viewport = {
                width: window.innerWidth,
                height: window.innerHeight
            };

            addResult('Screen Size', 'info', `Current viewport: ${viewport.width}x${viewport.height}`);

            if (viewport.width < 768) {
                addResult('Mobile Support', 'pass', 'Mobile viewport detected ‚úÖ');
            } else if (viewport.width < 1024) {
                addResult('Tablet Support', 'pass', 'Tablet viewport detected ‚úÖ');
            } else {
                addResult('Desktop Support', 'pass', 'Desktop viewport detected ‚úÖ');
            }

            // Test CSS media queries
            if (window.getComputedStyle) {
                addResult('CSS Support', 'pass', 'Advanced CSS supported ‚úÖ');
            } else {
                addResult('CSS Support', 'fail', 'Limited CSS support ‚ùå');
            }
        }

        // Test Complete Flow
        function testCompleteFlow() {
            addResult('Complete Flow', 'info', 'Testing complete booking flow...');
            
            const steps = [
                'Voice recognition initialized',
                'Customer provides name',
                'Customer provides date',
                'Customer provides time',
                'Customer provides party size',
                'Customer provides special requests',
                'Confirmation modal displayed',
                'Data saved to database',
                'Confirmation number generated'
            ];

            steps.forEach((step, index) => {
                setTimeout(() => {
                    addResult(`Step ${index + 1}`, 'pass', `${step} ‚úÖ`);
                }, index * 200);
            });

            setTimeout(() => {
                addResult('Complete Flow', 'pass', 'All booking steps completed ‚úÖ');
            }, steps.length * 200 + 500);
        }

        // Test Error Handling
        function testErrorHandling() {
            addResult('Error Handling', 'info', 'Testing error handling...');
            
            // Test various error scenarios
            const errorTests = [
                { name: 'Network Error', test: () => fetch('http://invalid-url') },
                { name: 'Invalid Data', test: () => JSON.parse('invalid json') },
                { name: 'Missing Elements', test: () => document.getElementById('nonexistent').click() }
            ];

            errorTests.forEach(({ name, test }) => {
                try {
                    test();
                    addResult(name, 'fail', 'Error not caught ‚ùå');
                } catch (error) {
                    addResult(name, 'pass', `Error properly caught: ${error.message} ‚úÖ`);
                }
            });
        }

        // Test Offline Mode
        function testOfflineMode() {
            addResult('Offline Mode', 'info', 'Testing offline mode...');
            
            // Test localStorage
            try {
                const testData = { test: 'offline data' };
                localStorage.setItem('mml_test', JSON.stringify(testData));
                const retrieved = JSON.parse(localStorage.getItem('mml_test'));
                
                if (retrieved.test === 'offline data') {
                    addResult('Offline Storage', 'pass', 'Local storage working ‚úÖ');
                    localStorage.removeItem('mml_test');
                } else {
                    addResult('Offline Storage', 'fail', 'Local storage failed ‚ùå');
                }
            } catch (error) {
                addResult('Offline Storage', 'fail', `Storage error: ${error.message} ‚ùå`);
            }

            // Test online/offline detection
            if (navigator.onLine) {
                addResult('Network Status', 'pass', 'Online connection detected ‚úÖ');
            } else {
                addResult('Network Status', 'info', 'Offline mode detected üì¥');
            }
        }

        // Auto-run basic tests on load
        window.onload = () => {
            addResult('System Test', 'info', 'MML Restaurant System Test Started üöÄ');
            setTimeout(testBrowserSupport, 500);
        };
    </script>
</body>
</html>
